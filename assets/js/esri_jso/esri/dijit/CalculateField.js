//>>built
require({cache:{"url:esri/dijit/templates/CalculateField.html":'\x3cdiv class\x3d"esriCalcField" style\x3d"width:100%;height:100%"\x3e\n  \x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" style\x3d"width:99%;margin-top:0.5em; margin-bottom: 0.5em;"\x3e\n    \x3cdiv data-dojo-attach-point\x3d"_header" class\x3d"esriCalcTitleLabel"\x3e\n       \x3cdiv class\x3d"esriAlignLeading"\x3e${i18n.expBuilderTitle}\x3c/div\x3e\n    \x3c/div\x3e\n    \x3cdiv style\x3d"clear:both; border-bottom: #CCC thin solid;height:4%;max-height:4em;width:100%;"\x3e\x3c/div\x3e\n  \x3c/div\x3e  \n  \x3cdiv data-dojo-type\x3d"dijit/form/Form" data-dojo-attach-point\x3d"_expressionForm" style\x3d"height:100%;width:99%;"\x3e\n    \x3cdiv class\x3d"esriFloatLeading" data-dojo-attach-point\x3d"_selCalcFieldDiv" style\x3d"width:100%;padding-bottom:0.5em;"\x3e\n      \x3cdiv\x3e\x3clabel class\x3d"esriLeadingMargin1"\x3e${i18n.selectCalField}\x3c/label\x3e\x3c/div\x3e\n      \x3cselect class\x3d"esriLeadingMargin1" style\x3d"width:50%;" data-dojo-type\x3d"dijit/form/Select" data-dojo-attach-point\x3d"_selCalcField" data-dojo-attach-event\x3d"onChange:_handleSelcCalFieldChange"\x3e\x3c/select\x3e\n    \x3c/div\x3e\n    \x3cdiv style\x3d"width:100%;" class\x3d"esriFloatLeading"\x3e\n      \x3clabel class\x3d"esriLeadingMargin1" data-dojo-attach-point\x3d"_calcFieldLabel"\x3e\x3c/label\x3e\n    \x3c/div\x3e\n    \x3cinput class\x3d"esriFloatLeading esriLeadingMargin1" style\x3d"width:95%;" data-dojo-type\x3d"dijit/form/SimpleTextarea" data-dojo-attach-point\x3d"_exprBox" data-dojo-props\x3d"rows:2 ,cols:2,required:true"\x3e\x3c/input\x3e  \n    \x3cdiv class\x3d"esriFloatTrailing esriTrailingMargin1"\x3e\n      \x3cdiv data-dojo-type\x3d"dijit/form/Button" class\x3d"esriActionButton" style\x3d"padding-top:0.5em;" data-dojo-props\x3d"label:\'${i18n.remove}\',iconClass:\'esriCalcFieldClearIcon\',showLabel: false, disabled:true" data-dojo-attach-event\x3d"onClick:_handleRemoveBtnClick" data-dojo-attach-point\x3d"_removeBtn"\x3e\x3c/div\x3e     \n      \x3c!--\n      \x3cdiv data-dojo-type\x3d"dijit/form/Button" class\x3d"esriActionButton" style\x3d"padding-top:0.5em;" data-dojo-props\x3d"label:\'${i18n.validate}\',iconClass:\'esriCalcFieldValidateIcon\',showLabel: false, disabled:true" data-dojo-attach-point\x3d"_validateBtn"\x3e\x3c/div\x3e--\x3e\n    \x3c/div\x3e\n    \x3cdiv class\x3d"esriFloatLeading" style\x3d"width:100%;padding-top:0.5em;padding-bottom:0.5em;"\x3e\n      \x3clabel class\x3d"esriLeadingMargin1 esriCalcTitleLabel"\x3e${i18n.operators}\x3c/label\x3e\n    \x3c/div\x3e    \n    \x3cdiv class\x3d"esriFloatLeading esriLeadingMargin1" style\x3d"width:100%;" data-dojo-attach-point\x3d"_operatorCtr"\x3e\n    \x3c/div\x3e\n    \x3cdiv style\x3d"clear:both;padding-top:0.5em;padding-bottom:0.5em;width:100%;height:65%;"\x3e\n      \x3cdiv class\x3d"esriFloatLeading"  style\x3d"width:50%;height:100%"\x3e\n        \x3cdiv style\x3d"padding-bottom:0.5em;"\x3e\x3clabel class\x3d"esriLeadingMargin1 esriCalcTitleLabel"\x3e${i18n.availableFields}\x3c/label\x3e\x3c/div\x3e\n        \x3cdiv style\x3d"width:100%;padding-bottom:0.5em;"\x3e\n          \x3clabel class\x3d"esriLeadingMargin1 esriSelectLabel esriTrailingMargin05"\x3e\n            \x3cinput type\x3d"radio" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-attach-point\x3d"_strRadioBtn" data-dojo-props\x3d"\'class\':\'esriSelectLabel\'" name\x3d"functionType" value\x3d"StrType"/\x3e\n            ${i18n.stringLabel}\n          \x3c/label\x3e\n          \x3clabel class\x3d"esriSelectLabel esriTrailingMargin05"\x3e\n            \x3cinput type\x3d"radio" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-attach-point\x3d"_numRadioBtn" data-dojo-props\x3d"\'class\':\'esriSelectLabel\'" name\x3d"functionType" value\x3d"NumType"/\x3e \n            ${i18n.numeric}\n          \x3c/label\x3e        \n          \x3clabel class\x3d"esriSelectLabel"\x3e\n            \x3cinput type\x3d"radio" data-dojo-type\x3d"dijit/form/RadioButton" data-dojo-attach-point\x3d"_dateRadioBtn"  data-dojo-props\x3d"\'class\':\'esriSelectLabel\'" name\x3d"functionType" value\x3d"DateType"/\x3e \n            ${i18n.dateLabel}\n          \x3c/label\x3e        \n        \x3c/div\x3e        \n        \x3cdiv class\x3d"esriLeadingMargin1" data-dojo-attach-point\x3d"_attributeListCtr" style\x3d"width:70%;height:85%;overflow-y:auto;"\x3e\n        \x3c/div\x3e\n      \x3c/div\x3e    \n      \x3cdiv class\x3d"esriFloatTrailing" style\x3d"width:50%;height:100%"\x3e\n        \x3cdiv style\x3d"padding-bottom:2em;"\x3e\n          \x3clabel class\x3d"esriCalcTitleLabel"\x3e${i18n.helpers}\x3c/label\x3e\n        \x3c/div\x3e\n        \x3cdiv data-dojo-attach-point\x3d"_helpersListCtr"  style\x3d"width:90%;height:85%;overflow-y:auto;"\x3e\n        \x3c/div\x3e\n      \x3c/div\x3e\n    \x3c/div\x3e\n    \x3cdiv class\x3d"esriLeadingMargin05 esriFormWarning esriRoundedBox" data-dojo-attach-point\x3d"_errorMessagePane" style\x3d"clear:both;display:none;height:3em;overflow-y:auto;padding:0.5em;"\x3e\n      \x3ca href\x3d"#" title\x3d"${i18n.close}" class\x3d"esriFloatTrailing closeIcon" title\x3d\'${i18n.close}\' data-dojo-attach-event\x3d"onclick:_handleCloseMsg"\x3e\n      \x3c/a\x3e\n      \x3cspan data-dojo-attach-point\x3d"_bodyNode" style\x3d"width:100%;height:100%;"\x3e\x3c/span\x3e\n    \x3c/div\x3e\n    \x3cdiv style\x3d"clear:both; border-bottom: #CCC thin solid; height:1px;width:100%;"\x3e\x3c/div\x3e\n    \x3cdiv  class\x3d"esriFloatTrailing esriTrailingMargin2" style\x3d"padding:1em 0"\x3e\n      \x3cdiv data-dojo-type\x3d"dijit/form/Button"  class\x3d"${addButtonClass}" data-dojo-attach-point\x3d"_addBtn" data-dojo-attach-event\x3d"onClick:_handleAddButtonClick"\x3e\n        ${i18n.add}\n      \x3c/div\x3e\n       \x3cdiv data-dojo-type\x3d"dijit/form/Button" class\x3d"esriLeadingMargin05 ${closeButtonClass}" data-dojo-attach-point\x3d"_closeBtn" data-dojo-attach-event\x3d"onClick:_handleCloseButtonClick"\x3e\n        ${i18n.close}\n      \x3c/div\x3e\n    \x3c/div\x3e\n  \x3c/div\x3e\n\x3c/div\x3e  \n'}});
define("esri/dijit/CalculateField","require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/fx dojo/has dojo/json dojo/string dojo/dom-style dojo/dom-attr dojo/dom-construct dojo/query dojo/dom-class dojo/_base/event dojo/Evented dojo/fx/easing dojo/store/Memory dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_OnDijitClickMixin dijit/_FocusMixin dijit/registry dijit/form/Button dijit/form/CheckBox dijit/form/Form dijit/form/Select dijit/form/MultiSelect dijit/form/TextBox dijit/form/SimpleTextarea dijit/form/ValidationTextBox dijit/layout/ContentPane dijit/form/ComboBox dijit/Dialog dijit/Tooltip dgrid/OnDemandList dgrid/Selection dgrid/Keyboard dgrid/extensions/DijitRegistry dgrid/util/mouse put-selector/put ../kernel ../lang ../request ./SingleFilter dojo/i18n!../nls/jsapi dojo/text!./templates/CalculateField.html".split(" "),
function(h,r,b,d,N,y,s,z,O,g,k,n,e,P,Q,t,A,u,p,B,C,D,E,F,R,G,S,T,U,V,W,X,Y,Z,$,aa,v,H,I,J,K,l,ba,q,ca,L,da,w,M){var x=r([H,J,I,K]);h=r([B,C,D,E,F,A],{declaredClass:"esri.dijit.CalculateField",templateString:M,basePath:h.toUrl("."),widgetsInTemplate:!0,showSelectField:!1,showHeader:!0,closeOnAdd:!0,addButtonClass:"",closeButtonClass:"",constructor:function(a){a.containerNode&&(this.container=a.containerNode)},destroy:function(){this.inherited(arguments)},postMixInProperties:function(){this.inherited(arguments);
this.i18n={};b.mixin(this.i18n,w.common);b.mixin(this.i18n,w.calculateFields)},postCreate:function(){this.inherited(arguments);this._buildUI();this._loadEvents();this.validate()},_buildUI:function(){var a=[];k.set(this._header,"display",this.showHeader?"block":"none");k.set(this._selCalcFieldDiv,"display",this.showSelectField?"block":"none");this.field&&n.set(this._calcFieldLabel,"innerHTML",g.substitute(this.i18n.exprLabel,{fieldName:this.field}));(!this.helperMethods||this.helperMethods&&0===this.helperMethods.length)&&
this.set("helperMethods",[{type:"NumType",label:"CEILING()",name:"CEILING()"},{type:"NumType",label:"EXP()",name:"EXP()"},{type:"NumType",label:"FLOOR()",name:"FLOOR()"},{type:"NumType",label:"FORMAT()",name:"FORMAT()"},{type:"NumType",label:"GREATEST()",name:"GREATEST()"},{type:"NumType",label:"LEAST()",name:"LEAST()"},{type:"NumType",label:"POWER()",name:"POWER(,)"},{type:"NumType",label:"ROUND()",name:"ROUND(,)"},{type:"NumType",label:"TRUNCATE()",name:"TRUNCATE(,)"},{type:"StrType",label:"CHAR_LENGTH()",
name:"CHAR_LENGTH()"},{type:"StrType",label:"CONCAT()",name:"CONCAT()"},{type:"StrType",label:"CONCAT_WS()",name:"CONCAT_WS()"},{type:"StrType",label:"INSERT()",name:"INSERT()"},{type:"StrType",label:"LEFT()",name:"LEFT()"},{type:"StrType",label:"LOWER()",name:"LOWER()"},{type:"StrType",label:"LTRIM()",name:"LTRIM()"},{type:"StrType",label:"REPLACE()",name:"REPLACE()"},{type:"StrType",label:"RIGHT()",name:"RIGHT()"},{type:"StrType",label:"RTRIM()",name:"RTRIM()"},{type:"StrType",label:"TRIM()",name:"TRIM()"},
{type:"StrType",label:"UPPER()",name:"UPPER()"},{type:"DateType",label:"CURRENTTIME()",name:"CURRENTTIME()"},{type:"DateType",label:"GETDATE()",name:"GETDATE()"},{type:"DateType",label:"CURRENT_TIMESTAMP()",name:"CURRENT_TIMESTAMP()"}]);(!this.operators||this.operators&&0===this.operators.length)&&this.set("operators","+-/*()".split(""));this._operatorBtns=[];d.forEach(this.operators,function(a){this._operatorBtns.push(new G({value:a,label:a,onClick:b.hitch(this,this._updateExpression,{value:a,type:"operator"})},
e.create("div",null,this._operatorCtr)))},this);if(this.layer&&this.layer.fields&&0<this.layer.fields.length){var a=this._createIds(this.layer.fields),c=d.map(this.layer.fields,function(a){return{label:a.name,value:a.name}});this._selCalcField.addOption(c);this._selCalcField.set("value",this.field)}this.fieldsStore=new p({data:a});this.attributeList=new x({renderRow:b.hitch(this,this._renderAttributesRow),selectionMode:"single",store:this.fieldsStore},this._attributeListCtr);a=this._createIds(this.get("helperMethods"));
this.operatorStore=new p({data:a});this.helpersList=new x({renderRow:b.hitch(this,this._renderOperatorRow),selectionMode:"single",store:this.operatorStore},this._helpersListCtr)},_loadEvents:function(){this.watch("layer",b.hitch(this,this._handleLayerChange));this.watch("field",b.hitch(this,this._handleFieldChange));this._expressionForm.watch("value",b.hitch(this,this._handleHelperTypeChange));this._expressionForm.on("focus",b.hitch(this,this._setfocus));this._exprBox.watch("value",b.hitch(this,this._handleExpChange));
this.attributeList.on("dgrid-select",b.hitch(this,function(a){this._updateExpression({value:a.rows[0].data,type:"field"})}));this.helpersList.on("dgrid-select",b.hitch(this,function(a){this._updateExpression({value:a.rows[0].data,type:"helper"})}));this.attributeList.on(l.enterRow,b.hitch(this,function(a){a=this.attributeList.row(a);this._showTooltip(a.element,a.data.alias||a.data.name)}));this.attributeList.on(l.leaveRow,b.hitch(this,function(a){a=this.attributeList.row(a);this._hideTooltip(a.element)}));
this.helpersList.on(l.enterRow,b.hitch(this,function(a){a=this.helpersList.row(a);this._showTooltip(a.element,a.data.label)}));this.helpersList.on(l.leaveRow,b.hitch(this,function(a){a=this.helpersList.row(a);this._hideTooltip(a.element)}));this.attributeList.on("dgrid-refresh-complete",b.hitch(this,this._setfocus));this.helpersList.on("dgrid-refresh-complete",b.hitch(this,this._setfocus));this._exprBox.on("blur",function(){this.set("cursorPosition",[this.textbox.selectionStart,this.textbox.selectionEnd])});
this._exprBox.on("focus",function(){var a=this.get("cursorPosition");a&&this.textbox.setSelectionRange(a[1],a[1])})},startup:function(){this.inherited(arguments);this.attributeList.startup();this.helpersList.startup();this._strRadioBtn.set("checked",!0)},reset:function(){q.show(this.domNode);this._expressionForm.reset();this._strRadioBtn.set("checked",!0)},_close:function(){this.emit("close",{});q.hide(this.domNode)},_createIds:function(a){var c=[];a&&0<a.length&&(c=d.map(a,function(a,c){return b.mixin(a,
{id:c})}));return c},_renderAttributesRow:function(a){var c=e.create("div",{"class":"esriCalExpRowOuter"}),b=e.create("div",{"class":"esriCalcExpLabelRow"},c);e.create("div",{"class":"esriCalcFieldTextTrimWithEllipses",innerHTML:a.name},b);return c},_renderOperatorRow:function(a){var c=e.create("div",{"class":"esriCalExpRowOuter"}),b=e.create("div",{"class":"esriCalcExpLabelRow"},c);e.create("div",{"class":"esriCalcFieldTextTrimWithEllipses",innerHTML:a.name},b);return c},_handleLayerChange:function(a,
c,b){a=[];this.layer&&(this.layer.fields&&0<this.layer.fields.length)&&(0<this._selCalcField.getOptions().length&&this._selCalcField.removeOption(this._selCalcField.getOptions()),a=this._createIds(this.layer.fields),c=d.map(this.layer.fields,function(a){return{label:a.name,value:a.name}}),this._selCalcField.addOption(c),this._selCalcField.set("value",this.field));this.fieldsStore=new p({data:a});this.attributeList.set("store",this.fieldsStore)},_handleFieldChange:function(a,c,b){n.set(this._calcFieldLabel,
"innerHTML",g.substitute(this.i18n.exprLabel,{fieldName:b}));this._setfocus()},_handleHelperTypeChange:function(a,c,b){this.helpersList.set("query",{type:b.functionType});"DateType"===b.functionType?this.attributeList.set("query",{type:"esriFieldTypeDate"}):"StrType"===b.functionType?this.attributeList.set("query",{type:"esriFieldTypeString"}):"NumType"===b.functionType&&this.attributeList.set("query",function(a){return-1!==d.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle",
"esriFieldTypeDouble"],a.type)});this.helpersList.refresh();this.attributeList.refresh()},_handleSelcCalFieldChange:function(a){this.set("field",a)},_handleRemoveBtnClick:function(){this._exprBox.set("value","");this._setfocus()},_handleAddButtonClick:function(a){t.stop(a);a={f:"json"};this._exprBox.get("value")?(a.calcExpression=this.get("expression"),a=L({url:this.layer.url+"/calculate",content:a},{usePost:!0}),this.emit("calculate",{calcPromise:a.promise}),this._addBtn.set("disabled",!0),a.then(b.hitch(this,
function(a){this._addBtn.set("disabled",!1);this._showMessages(g.substitute(this.i18n.successMsg,{count:a.updatedFeatureCount}),!0);this.closeOnAdd&&this._close()}),b.hitch(this,function(a){this._addBtn.set("disabled",!1);this._showMessages(a.details.toString(),!0)}))):this._addBtn.set("disabled",!0)},_handleCloseButtonClick:function(a){t.stop(a);this._close()},_showTooltip:function(a,b){var m=e.create("label",{innerHTML:b,className:"esriSmallFont"});v.show(m.outerHTML,a,["below"])},_hideTooltip:function(a,
b){v.hide(a)},_setfocus:function(){this._exprBox.focus()},_showMessages:function(a,c){n.set(this._bodyNode,"innerHTML",a);s.fadeIn({node:this._errorMessagePane,easing:u.quadIn,onEnd:b.hitch(this,function(){k.set(this._errorMessagePane,{display:""})})}).play();c&&window.setTimeout(b.hitch(this,this._handleCloseMsg),2E3)},_handleCloseMsg:function(a){a&&a.preventDefault();s.fadeOut({node:this._errorMessagePane,easing:u.quadOut,onEnd:b.hitch(this,function(){k.set(this._errorMessagePane,{display:"none"})})}).play()},
validate:function(){var a=!0;this.layer?this.field?this.layer.supportsCalculate?this.layer.getEditCapabilities().canUpdate&&(g.substitute(this.i18n.lyrUpdateCapMsg,{layername:this.layer.name}),a=!1):(g.substitute(this.i18n.lyrSupportCalMsg,{layername:this.layer.name}),a=!1):a=!1:a=!1;this._addBtn.set("disabled",!a);return a},_validateExpObj:function(a){var b=!0;a||(b=!1);b?this._handleCloseMsg():this._showMessages(void 0);return b},_updateExpression:function(a){var b=this._exprBox.get("cursorPosition"),
m=this._exprBox.get("value"),e="",d=0,f;this._validateExpObj(a)&&("operator"===a.type?(f=" "+a.value+" ",d=f.length):"helper"===a.type?(f=a.value.name,d=-1!==a.value.name.indexOf(",")?a.value.name.indexOf(","):a.value.name.length-1):"field"===a.type&&(f=a.value.name,d=f.length+1),e=m.substring(0,b[0])+f+m.substring(b[1]),this._exprBox.set("value",e),this._exprBox.focus(),this._exprBox.textbox.setSelectionRange(b[0]+d,b[0]+d),this._setfocus())},_handleExpChange:function(a,b,d){this._addBtn.set("disabled",
!d);this._removeBtn.set("disabled",!d)},_setLayerAttr:function(a){this._set("layer",a)},_setFieldAttr:function(a){this._set("field",a)},_setHelperMethodsAttr:function(a){this._set("helperMethods",a)},_setOperatorsAttr:function(a){this._set("operators",a)},_setShowSelectFieldAttr:function(a){this._set("showSelectField",a)},_setShowHeaderAttr:function(a){this._set("showHeader",a)},_setCloseOnAddAttr:function(a){this._set("closeOnAdd",a)},_getExpressionAttr:function(){var a=this._exprBox.get("value"),
b,d;if(a)return a.split(" "),d=[],b={field:this.field},b.sqlExpression=a,d.push(b),y.toJson(d);this._addBtn.set("disabled",!0)},_setAddButtonClassAttr:function(a){this._set("addButtonClass",a)},_setCloseButtonClassAttr:function(a){this._set("closeButtonClass",a)}});z("extend-esri")&&b.setObject("dijit.CalculateField",h,q);return h});